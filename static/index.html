<!DOCTYPE html>
<html>
    <head>
        <title>OSM Map - MapLibre GL JS</title>

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
        <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />

        <style>
            html, body, #map {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
        </style>
    </head>

    <body>
        <div id="map"></div>

        <script>
            // MapLibre GL JS with 512px tiles and nearest-neighbor resampling
            const map = new maplibregl.Map({
                container: 'map',
                center: [0, 0],
                zoom: 3,
                style: {
                    version: 8,
                    sources: {
                        'osm-tiles': {
                            type: 'raster',
                            // Request 512px (@2x) tiles from backend
                            tiles: [window.location.origin + '/tile/{z}/{x}/{y}@2x.png'],

                            // Tell MapLibre these are 512px tiles
                            // This ensures proper scaling and crisp rendering
                            tileSize: 512,

                            minzoom: 0,
                            maxzoom: 18
                        }
                    },
                    layers: [{
                        id: 'osm-layer',
                        type: 'raster',
                        source: 'osm-tiles',
                        minzoom: 0,
                        maxzoom: 22,
                        paint: {
                            'raster-resampling': 'nearest'
                        }
                    }]
                },
                // Performance settings
                hash: true,  // URL hash for sharing
                fadeDuration: 0,  // No fade animation - instant display
                attributionControl: true
            });

            // Add attribution
            map.on('load', function() {
                map.addControl(new maplibregl.AttributionControl({
                    customAttribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
                }));
            });

            // Add navigation controls (zoom buttons)
            map.addControl(new maplibregl.NavigationControl());
        </script>
    </body>
</html>
